# TCP服务器客户端程序

这个项目实现了三种不同类型的TCP服务器和一个通用的TCP客户端，用于学习和测试网络编程。

## 文件说明

- `servertcp.c` - 服务器端程序，包含三种服务器实现
- `clienttcp.c` - 客户端程序
- `Makefile` - 编译脚本
- `README.md` - 使用说明

## 服务器类型

### 1. 基础TCP服务器
- **特点**: 单线程，同时只能处理一个客户端连接
- **适用场景**: 学习基础TCP编程概念
- **优点**: 简单易懂，资源消耗少
- **缺点**: 并发性差，一个客户端阻塞会影响其他客户端

### 2. 多进程TCP服务器
- **特点**: 每个客户端连接创建一个新进程处理
- **适用场景**: 需要进程隔离的应用
- **优点**: 进程间隔离好，一个进程崩溃不影响其他进程
- **缺点**: 进程创建开销大，内存消耗较多

### 3. 多线程TCP服务器
- **特点**: 每个客户端连接创建一个新线程处理
- **适用场景**: 高并发网络应用
- **优点**: 线程创建开销小，资源共享方便
- **缺点**: 需要处理线程安全问题

## 编译

### 使用Makefile编译
```bash
# 编译所有程序
make

# 或者分别编译
make servertcp
make clienttcp

# 查看帮助
make help

# 清理编译文件
make clean
```

### 手动编译
```bash
# 编译服务器
gcc -Wall -Wextra -std=c99 -pthread -o servertcp servertcp.c

# 编译客户端
gcc -Wall -Wextra -std=c99 -pthread -o clienttcp clienttcp.c
```

## 使用方法

### 启动服务器

1. 运行服务器程序：
```bash
./servertcp
```

2. 选择服务器类型：
```
TCP服务器程序
请选择服务器类型:
1. 基础TCP服务器 (单线程，一次处理一个客户端)
2. 多进程TCP服务器 (每个客户端一个进程)
3. 多线程TCP服务器 (每个客户端一个线程)
请输入选择 (1-3): 
```

3. 服务器将在端口8888上监听连接

### 启动客户端

#### 连接到本地服务器
```bash
./clienttcp
```

#### 连接到远程服务器
```bash
# 连接到指定IP的默认端口(8888)
./clienttcp 192.168.1.100

# 连接到指定IP和端口
./clienttcp 192.168.1.100 9999

# 查看帮助
./clienttcp -h
```

## 测试场景

### 1. 本地测试
```bash
# 终端1：启动服务器
./servertcp
# 选择服务器类型

# 终端2：启动客户端
./clienttcp
```

### 2. 跨机器测试

**服务器端（假设IP为192.168.1.100）：**
```bash
./servertcp
# 选择服务器类型
```

**客户端（其他机器）：**
```bash
./clienttcp 192.168.1.100
```

### 3. 并发测试

启动多个客户端来测试不同服务器类型的并发处理能力：

```bash
# 同时启动多个客户端
./clienttcp 192.168.1.100 &
./clienttcp 192.168.1.100 &
./clienttcp 192.168.1.100 &
```

## 网络配置

### 防火墙设置
如果无法连接，可能需要配置防火墙：

**Ubuntu/Debian:**
```bash
sudo ufw allow 8888
```

**CentOS/RHEL:**
```bash
sudo firewall-cmd --permanent --add-port=8888/tcp
sudo firewall-cmd --reload
```

### 查看网络状态
```bash
# 查看端口监听状态
netstat -tlnp | grep 8888

# 或使用ss命令
ss -tlnp | grep 8888
```

## 测试命令

### 使用telnet测试
```bash
telnet 服务器IP 8888
```

### 使用nc (netcat)测试
```bash
nc 服务器IP 8888
```

## 性能对比测试

可以使用以下脚本测试不同服务器类型的性能：

```bash
#!/bin/bash
# 创建多个并发连接测试脚本
for i in {1..10}; do
    (echo "客户端 $i 的消息"; sleep 1; echo "quit") | ./clienttcp 192.168.1.100 &
done
wait
```

## 注意事项

1. **端口占用**: 确保端口8888没有被其他程序占用
2. **权限问题**: 某些系统可能需要管理员权限来绑定端口
3. **网络连通性**: 确保客户端和服务器之间网络连通
4. **进程/线程限制**: 系统可能对进程和线程数量有限制

## 常见问题

### Q: 连接被拒绝
A: 检查服务器是否正在运行，端口是否正确，防火墙是否阻止连接

### Q: 地址已在使用
A: 等待几秒钟让系统释放端口，或者重启程序

### Q: 多个客户端连接基础服务器时只有一个能工作
A: 这是正常的，基础服务器设计为单线程，请使用多进程或多线程服务器

## 扩展功能

可以基于这个基础框架扩展以下功能：

1. **消息广播**: 服务器向所有客户端广播消息
2. **用户认证**: 添加用户登录验证
3. **消息加密**: 使用SSL/TLS加密通信
4. **日志记录**: 记录连接和消息日志
5. **配置文件**: 支持配置文件设置端口等参数

## 学习要点

1. **Socket编程基础**: 理解socket创建、绑定、监听、连接过程
2. **并发处理**: 比较单线程、多进程、多线程的优缺点
3. **网络通信**: 理解TCP协议的可靠传输特性
4. **系统编程**: 学习进程创建、线程管理、信号处理